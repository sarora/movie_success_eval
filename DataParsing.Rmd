---
title: "ParseData"
author: "Sidd"
date: "December 7, 2017"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:


## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
```{r}
library(jsonlite)
library(lubridate)
library(purrr)
library(tidyverse)
library(forcats)


```

### Cleaning Data

```{r}

#read in data
movie_data <- read.csv("data/tmdb_5000_movies.csv", header=TRUE, sep=",")

#filtering out rows which have empty genre json.
movie_data <- movie_data %>%  filter(genres != "[]")

#convert release_date to type date 
movie_data <- movie_data %>% mutate(release_date = ymd(release_date))

#get JSON data for genre from the table
genre_from_json<- map(as.character(movie_data$genres),fromJSON)

#empty vector to store primary genres for movies
movie_genres_primary <- vector('character',length(genre_from_json)) 

#empty vector to store connected genres for movies
movie_connected_genres <- vector('character',length(genre_from_json)) 

#populate all primary genre and connected genres associated with movies. The connected genres will be in csv format.
for(g in seq_along(movie_genres_primary)){
   genre_json_length <- length(genre_from_json[[g]]$name)
    movie_genres_primary[g] <- genre_from_json[[g]]$name[[1]]
    if(genre_json_length>1){
       movie_connected_genres[g]  <- paste0(genre_from_json[[g]]$name[2:genre_json_length],collapse=",")
    }
}


# Join the genre vector to the dataframe
movie_data <- cbind(movie_data,movie_genres_primary,movie_connected_genres)

## Getting the primary genre of each movie. The rest will go in c genre
##a <- cSplit(movie_data_0812, 'movie_genres_csv', ',', 'wide')

#filter movies 2012-Present
movie_data_last5years <- movie_data %>% filter(year(release_date) > 2012)

#filter movies 2008-2012
movie_data_0812 <- movie_data %>% filter(year(release_date) %in% (2008:2012))

#select relevant columns
movie_data_last5years <- movie_data_last5years %>% select(original_title,release_date,popularity,movie_genres_primary,movie_connected_genres)

#select relevant columns
movie_data_0812 <- movie_data_0812 %>% select(original_title,release_date,popularity,movie_genres_primary,movie_connected_genres)


```

### Analysis
```{r, fig.width=11}

movie_data_0812_count<- movie_data_0812 %>% group_by(movie_genres_primary) %>% summarise(genre_count = n())
movie_data_last5_count<- movie_data_last5years %>% group_by(movie_genres_primary) %>% summarise(genre_count = n())

m0812<- ggplot(data=movie_data_0812_count, aes(x=fct_reorder((movie_genres_primary),genre_count), y=genre_count))+
  geom_bar(stat="identity", fill="indianred4") +
    labs(x="Movie Genre", y = "Number of Movies", title = "Genre of Movies released between 2008-2012" ) +
      coord_flip() + theme_minimal()
  
mlast5<- ggplot(data=movie_data_last5_count, aes(x=fct_reorder((movie_genres_primary),genre_count), y=genre_count))+
  geom_bar(stat="identity", fill="tan2") +
    labs(x="Movie Genre", y = "Number of Movies", title = "Genre of Movies released between 2013-2017" ) +
      coord_flip() + theme_minimal()
  

cowplot::plot_grid(m0812,mlast5, ncol=2)


```

